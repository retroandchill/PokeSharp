#nullable enable
using System.Diagnostics.CodeAnalysis;
using Microsoft.Extensions.DependencyInjection;
using PokeSharp.Core;
using PokeSharp.Core.Data;

namespace {{Namespace}};

partial {{ClassType}} {{ClassName}} : I{{EntityType}}GameDataEntity<{{Key}}, {{ClassName}}> 
{
    private static CachedService<{{EntityType}}GameDataSet<{{ClassName}}, {{Key}}>> _data = new();

    private static {{EntityType}}GameDataSet<{{ClassName}}, {{Key}}> Data => _data.Instance;

    {{#IsLoaded}}
    public static string DataPath => "{{DataPath}}";
    
    {{#IsOptional}}
    public static bool IsOptional => true;
    {{/IsOptional}}
    {{/IsLoaded}}

    public static IEnumerable<{{Key}}> Keys => Data.Keys;
    
    public static IEnumerable<{{ClassName}}> Entities => Data.Entities;
    
    public static int Count => Data.Count;
    
    public static bool Exists({{Key}} key) => Data.Exists(key);
    
    public static {{ClassName}} Get({{Key}} key) => Data.Get(key);
    
    public static bool TryGet({{Key}} key, {{#IsReferenceType}}[NotNullWhen(true)] {{/IsReferenceType}}out {{ClassName}}{{#IsReferenceType}}?{{/IsReferenceType}} entity) => Data.TryGet(key, out entity);
    
    public static int IndexOf({{Key}} key) => Data.IndexOf(key);

    {{#IsLoaded}}
    public static void Import(IEnumerable<{{ClassName}}> entities) => Data.Import(entities);    
        
    public static ValueTask ImportAsync(IEnumerable<{{ClassName}}> entities, CancellationToken cancellationToken = default) => Data.ImportAsync(entities, cancellationToken);
    
    public static void Load() => Data.Load();
    
    public static ValueTask LoadAsync(CancellationToken cancellationToken = default) => Data.LoadAsync(cancellationToken);

    public static void Save() => Data.Save();

    public static ValueTask SaveAsync(CancellationToken cancellationToken = default) => Data.SaveAsync(cancellationToken);
    {{/IsLoaded}}
    {{^IsLoaded}}
    public static void Register({{ClassName}} entity) { }
    {{/IsLoaded}}

    {{#Identifiers}}
    public static readonly {{../Key}} {{Identifier}} = "{{Identifier}}";   
    {{/Identifiers}}
}