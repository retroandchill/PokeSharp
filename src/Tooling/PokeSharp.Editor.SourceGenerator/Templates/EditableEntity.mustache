#nullable enable
using System.Collections.Immutable;
using System.Linq.Expressions;
using System.Text.Json;
using System.Runtime.CompilerServices;
using PokeSharp.Core.Collections;
using PokeSharp.Core.Collections.Immutable;
using PokeSharp.Core.Strings;
using PokeSharp.Editor.Core.PokeEdit.Properties;
using PokeSharp.Editor.Core.PokeEdit.Schema;
using PokeSharp.Editor.Core.PokeEdit;

{{#HasForCalls}}
namespace System.Runtime.CompilerServices
{
    [AttributeUsage(AttributeTargets.Method, AllowMultiple = true)]
    file sealed class InterceptsLocationAttribute(int version, string data) : Attribute;
}

namespace PokeSharp.Editor.Generated
{
    internal static class {{ClassName}}Interceptor 
    {
        {{#ForCalls}}
        [InterceptsLocation({{Version}}, "{{Data}}")]
        {{/ForCalls}}
        internal static EditorModelBuilder For_{{ClassName}}_Intercept(
            this EditorModelBuilder builder, 
            Action<EditableTypeBuilder<{{Namespace}}.{{ClassName}}>>? configure = null)
        {
            var typeBuilder = new EditableTypeBuilder<{{Namespace}}.{{ClassName}}>(builder);
            return builder.Add(typeBuilder
                {{#Properties}}
                .Property(new Editable{{PropertyType}}PropertyBuilder<{{../Namespace}}.{{../ClassName}},{{#IsDictionary}} {{KeyType}},{{/IsDictionary}} {{ValueType}}>(
                    typeBuilder,
                    "{{Name}}",
                    root => root.{{Name}},
                    (root, value) => root with { {{Name}} = value },
                    {{DefaultValue}}
                ))
                {{/Properties}}
            );
        }
    }
}
{{/HasForCalls}}